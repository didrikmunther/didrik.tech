{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/App.ts","webpack:///./src/js/Ctx.ts","webpack:///./src/js/Flappy.ts","webpack:///./src/js/Game.ts","webpack:///./src/js/NeuralNet.ts","webpack:///./src/js/Resource.ts"],"names":["createGame","TextPosition","RenderPriority","Important","Text","Normal","getColor","r","g","b","a","Math","round","drawCircle","ctx","x","y","rad","color","beginPath","arc","PI","strokeStyle","fillStyle","fill","stroke","drawLine","x1","y1","x2","y2","w","moveTo","lineTo","lineWidth","drawText","text","fillText","Ctx","constructor","options","h","size","_queue","showFps","textCoordinates","TopLeft","Middle","init","loop","canvas","document","createElement","width","height","body","appendChild","getContext","font","queueText","fps","toFixed","now","req","requestAnimationFrame","time","clearRect","filter","alive","sort","priority","forEach","func","queue","push","i","findIndex","v","console","error","splice","position","remove","padv","padh","PIPE_GAP","PIPE_MARGIN","PIPE_SPEED","PIPE_ACCELERATION","BIRD_AMOUNT","BIRD_GRAVITY","BIRD_FORCE","DEFAULT_FPS","NETWORK_INPUTS","NETWORK_OUTPUTS","NETWORK_STRUCTURE","hidden","timeouts","messageName","setZeroTimeout","fn","window","postMessage","handleMessage","event","source","data","stopPropagation","length","shift","addEventListener","Movable","vY","vX","collides","pos","Bird","force","net","dead","score","dims","Resources","bird","dimensions","pipes","screenWidth","screenHeight","Dimensions","some","pipe","inputs","getHeight","getX","netResult","forward","jump","draw","Pipe","padding","pipeTop","top","bottom","pipeBottom","Flappy","params","birds","pipeSpeed","maxScore","generation","FPS","pauseWhenHighscore","automaticSuperSpeed","desiredStructure","nctx","render","bind","renderNet","querySelector","target","checked","respawn","reset","value","JSON","parse","_loop","e","code","createBirds","amount","getNet","Array","map","max","best","firstGen","NeuralNet","nextGeneration","setTimeout","random","Resource","background","innerWidth","files","Object","entries","loadedFiles","loading","load","then","Promise","all","sigmoid","z","exp","sigmoidf","MUTATION_CHANCE","MUTATION_FORCE","Neuron","weights","values","lastValue","reduce","randomize","getLastValue","structure","neurons","result","layer","neuron","radius","tallest","layeri","layerarr","neuroni","missing","file","loaded","img","Image","src","didLoad","res","rej","onload","status","onerror","err","angle","warn","_x","_y","save","translate","rotate","drawImage","restore"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/App.ts\");\n","import { createGame } from \"./Game\";\n\ncreateGame();","\nexport enum TextPosition {\n    TopLeft,\n    Middle\n};\n\nexport interface CtxOptions {\n    w?: number,\n    h?: number,\n    size?: number,\n    showFps?: boolean,\n};\n\nexport const RenderPriority = {\n    Important: 30,\n    Text: 20,\n    Normal: 10\n};\n\nexport type RenderFunction = (ctx: CanvasRenderingContext2D) => void;\nexport type RenderTextFunction = () => string;\nexport type RemoveRenderFunction = () => void;\nexport type AliveFunction = () => boolean;\n\nconst getColor = ([r, g, b, a]: [number, number, number, number]): string => `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, ${a})`;\n\nexport const drawCircle = (ctx: CanvasRenderingContext2D, x: number, y: number, rad: number, color: [number, number, number, number]) => {\n    ctx.beginPath();\n    ctx.arc(x, y, rad, 0, 2*Math.PI);\n    ctx.strokeStyle = getColor([0,0,0,0]);\n    ctx.fillStyle = getColor(color);\n    ctx.fill();\n    ctx.stroke();\n};\n\nexport const drawLine = (ctx, x1, y1, x2, y2, color: [number, number, number, number], w?: number) => {\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.lineWidth = w;\n    ctx.strokeStyle = 'black';\n    ctx.stroke();\n    ctx.lineWidth = w;\n    ctx.strokeStyle = getColor(color);\n    ctx.stroke();\n};\n\nexport const drawText = (ctx, text: string, x: number, y: number, color: [number, number, number, number]) => {\n    ctx.strokeStyle = getColor(color);\n    ctx.fillStyle = getColor(color);\n    ctx.fillText(text, x, y);\n}\n\nexport default class Ctx {\n    private w: number = 500;\n    private h: number = 500;\n    private size: number = 24; // font size\n\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n\n    private _queue: {\n        func: RenderFunction,\n        alive: AliveFunction,\n        priority?: number\n    }[] = [];\n\n    private fps: number;\n    private options: CtxOptions = {\n        showFps: false\n    };\n\n    private text: {\n        [position in TextPosition]?: RenderTextFunction[]\n    } = {};\n\n    private textCoordinates: {\n        [position in TextPosition]: () => [number, number, number, number] // w, h, padding-vertical, padding-horizontal\n    } = {\n        [TextPosition.TopLeft]: () => [0, 0, this.size / 2, this.size / 2],\n        [TextPosition.Middle]: () => [this.w / 2, this.h / 2, this.size / 2, 0],\n    };\n\n    constructor(options: CtxOptions = {}) {\n        this.options = options;\n        this.w = options.w || this.w;\n        this.h = options.h || this.h;\n        this.size = options.size || this.size;\n\n        this.options = {...options, ...this.options};\n\n        this.init();\n        this.loop();\n    }\n\n    private init() {\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.w;\n        this.canvas.height = this.h;\n\n        this.ctx = document.body.appendChild(this.canvas).getContext('2d');\n        this.ctx.font = `${this.size}px Arial`;\n\n        this.queueText(() => `Fps: ${this.fps.toFixed(1)}`, () => this.options.showFps);\n    }\n\n    private loop(): void {\n        let now;\n        const req = () => requestAnimationFrame(time => {\n            this.fps = 1e3 / (time - now);\n            this.ctx.clearRect(0, 0, this.w, this.h);\n            this._queue.filter(({alive}) => alive())\n                .sort((a, b) => +a.priority - +b.priority)\n                .forEach(({func}) => func(this.ctx));\n\n            now = time;\n            req();\n        });\n        req();\n    }\n\n    public queue(func: RenderFunction, alive: AliveFunction, priority: number = RenderPriority.Normal): RemoveRenderFunction {\n        this._queue.push({ func, alive, priority });\n        return () => {\n            const i = this._queue.findIndex(v => v.func == func);\n            if(i == -1)\n                console.error(`Failed to remove render function`, func, alive);\n            else\n                this._queue.splice(i, 1);\n        };\n    }\n\n    public queueText(text: RenderTextFunction, alive: AliveFunction, position: TextPosition = TextPosition.TopLeft): RemoveRenderFunction {\n        if(!this.text[position]) this.text[position] = [];\n        this.text[position].push(text);\n\n        const remove = this.queue(ctx => {\n            const i = this.text[position].findIndex(v => v == text);\n\n            const [w, h, padv, padh] = this.textCoordinates[position]();\n            ctx.fillText(text(), w + padh, h + (i + 1) * (this.size + padv));\n        }, alive, RenderPriority.Text);\n\n        return () => {\n            remove();\n        };\n    }\n}","import NeuralNet from \"./NeuralNet\";\nimport Ctx from \"./Ctx\";\nimport { Resources, Dimensions } from './Game';\n\nconst PIPE_GAP = 100;\nconst PIPE_MARGIN = 0;\nconst PIPE_SPEED = -3;\nconst PIPE_ACCELERATION = -0.01;\nconst BIRD_AMOUNT = 50;\nconst BIRD_GRAVITY = 0.25;\nconst BIRD_FORCE = -6;\nconst DEFAULT_FPS = 60.0;\n\nconst NETWORK_INPUTS = 3;\nconst NETWORK_OUTPUTS = 1;\nconst NETWORK_STRUCTURE = hidden => [NETWORK_INPUTS, ...hidden, NETWORK_OUTPUTS];\n\nexport interface FlappyParams {\n    ctx: Ctx,\n    nctx?: Ctx\n};\n\n(function() {\n\tvar timeouts = [];\n\tvar messageName = \"zero-timeout-message\";\n\n\tfunction setZeroTimeout(fn) {\n\t\ttimeouts.push(fn);\n\t\twindow.postMessage(messageName, \"*\");\n\t}\n\n\tfunction handleMessage(event) {\n\t\tif (event.source == window && event.data == messageName) {\n\t\t\tevent.stopPropagation();\n\t\t\tif (timeouts.length > 0) {\n\t\t\t\tvar fn = timeouts.shift();\n\t\t\t\tfn();\n\t\t\t}\n\t\t}\n\t}\n\n\twindow.addEventListener(\"message\", handleMessage, true);\n\n\t(window as any).setZeroTimeout = setZeroTimeout;\n})();\n\nclass Movable {\n    public x: number;\n    public y: number;\n    public w: number;\n    public h: number;\n\n    public vY: number = 0;\n    public vX: number = 0;\n\n    constructor(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n    }\n\n    public loop() {\n        this.y += this.vY;\n        this.x += this.vX;\n    }\n\n    public collides(pos: Movable): boolean {\n        return !(pos.x > this.x + this.w\n            || pos.x + pos.w < this.x\n            || pos.y > this.y + this.h\n            || pos.y + pos.h < this.y);\n    }\n}\n\nclass Bird {\n    private pos: Movable;\n    private force: number;\n    private g: number;\n\n    public net: NeuralNet;\n    public dead: boolean = false;\n    public score: number = 0;\n    \n    constructor(x: number, y: number, g: number, force: number, net: NeuralNet) {\n        const dims = Resources.bird.dimensions();\n        this.pos = new Movable(x, y, dims[0], dims[1]);\n        this.g = g;\n        this.force = force;\n        this.net = net;\n    }\n\n    public loop(pipes: Pipe[]): void {\n        const [screenWidth, screenHeight] = Dimensions;\n\n        if(this.pos.y > screenHeight || this.pos.y < 0) this.dead = true;\n        if(pipes.some(pipe => pipe.collides(this.pos))) this.dead = true;\n\n        if(this.dead) return;\n        this.score++;\n\n        const inputs = [this.pos.y / screenHeight, pipes[0].getHeight() / screenHeight, pipes[0].getX() / screenWidth];\n        // console.log(this.pos.y, screenHeight);\n        const netResult = this.net.forward(inputs);\n        if(netResult[0] >= .5) this.jump();\n\n        this.pos.vY += this.g;\n        this.pos.loop();\n    }\n\n    public jump(): void {\n        this.pos.vY = this.force;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D): void {\n        Resources.bird.draw(ctx, this.pos.x, this.pos.y, null, null, Math.PI/2 * this.pos.vY/20);\n    }\n}\n\nclass Pipe {\n    private h: number;\n    private padding: number = PIPE_GAP;\n\n    private top: Movable;\n    private bottom: Movable;\n\n    public dead: boolean = false;\n\n    constructor(x, h, vX) {\n        const dims = Resources.pipeTop.dimensions();\n\n        this.top = new Movable(x, h - dims[1], dims[0], dims[1]);\n        this.bottom = new Movable(x, h + this.padding, dims[0], dims[1]);\n        this.top.vX = vX;\n        this.bottom.vX = vX;\n        this.h = h;\n    }\n\n    public loop() {\n        if(this.top.x + Resources.pipeTop.dimensions()[0] < 0) this.dead = true;\n        this.top.loop();\n        this.bottom.loop();\n    }\n\n    public draw(ctx: CanvasRenderingContext2D) {\n        Resources.pipeTop.draw(ctx, this.top.x, this.h - Resources.pipeTop.dimensions()[1]);\n        Resources.pipeBottom.draw(ctx, this.bottom.x, this.h + this.padding);\n        // ctx.fillRect(this.pos.x, this.h, Resources.pipeTop.dimensions()[0], this.padding);\n    }\n\n    public collides(pos: Movable): boolean {\n        return this.top.collides(pos) || this.bottom.collides(pos);\n    }\n\n    public getHeight(): number {\n        return this.h;\n    }\n\n    public getX(): number {\n        return this.bottom.x;\n    }\n}\n\nexport default class Flappy {\n    private ctx: Ctx; // main ctx\n    private nctx: Ctx; // NeuralNet ctx\n\n    private birds: Bird[] = [];\n    private pipes: Pipe[] = [];\n\n    private pipeSpeed = PIPE_SPEED;\n    private score: number = 0;\n    private maxScore: number = 0;\n    private generation: number = 0;\n    private FPS: number = DEFAULT_FPS;\n    private pauseWhenHighscore: boolean = true;\n    private automaticSuperSpeed: boolean = true;\n    private desiredStructure: number[] = [2, 2];\n\n    constructor(params: FlappyParams) {\n        this.ctx = params.ctx;\n        this.nctx = params.nctx;\n        this.init();\n    }\n\n    private init(): void {\n        this.ctx.queue(this.render.bind(this), () => true);\n        this.nctx.queue(this.renderNet.bind(this), () => true);\n\n        this.ctx.queueText(() => `Score: ${this.score}`, () => true);\n        this.ctx.queueText(() => `Max score: ${this.maxScore}`, () => true);\n        this.ctx.queueText(() => `Birds: ${this.birds.filter(({ dead }) => !dead).length}/${BIRD_AMOUNT}`, () => true);\n        this.ctx.queueText(() => `Generation: ${this.generation}`, () => true);\n\n        document.addEventListener('keydown', this.event.bind(this));\n        document.querySelector('#speed-normal').addEventListener('click', () => this.FPS = DEFAULT_FPS);\n        document.querySelector('#speed-super').addEventListener('click', () => this.FPS = -1);\n        document.querySelector('#pause').addEventListener('click', ({ target }) => this.pauseWhenHighscore = (target as any).checked);\n        document.querySelector('#auto-speed-super').addEventListener('click', ({ target }) => this.automaticSuperSpeed = (target as any).checked);\n        document.querySelector('#respawn').addEventListener('click', () => this.respawn());\n        document.querySelector('#reset').addEventListener('click', () => this.reset());\n        document.querySelector('#structure').addEventListener('input', ({ target }) => this.desiredStructure = (target as any).value);\n        document.querySelector('#set-structure').addEventListener('click', () => {\n            this.desiredStructure = JSON.parse(`[${this.desiredStructure}]`);\n            this.reset();\n        });\n\n        this._loop();\n    }\n\n    private event(e: KeyboardEvent) {\n        if(e.code == 'Space') {\n            this.birds[0].jump();\n        }\n    }\n\n    private reset(): void {\n        this.pipes = [];\n        this.maxScore = 0;\n        this.score = 0;\n        this.generation = 0;\n        this.birds = [];\n        this.respawn();\n    }\n\n    private createBirds(amount: number, getNet: () => NeuralNet): Bird[] {\n        return [...Array(amount)]\n            .map(() => new Bird(50, Dimensions[1] / 2, BIRD_GRAVITY, BIRD_FORCE, getNet()));\n    }\n\n    private respawn(): void {\n        this.pipeSpeed = PIPE_SPEED;\n        this.pipes = [];\n        this.maxScore = Math.max(this.maxScore, this.score);\n        this.score = 0;\n\n        const birds = this.birds.sort((a, b) => b.score - a.score);\n        const [best] = birds;\n\n        const firstGen = () => new NeuralNet(NETWORK_STRUCTURE(this.desiredStructure));\n\n        if(best) {\n            this.birds = [\n                ...this.createBirds(BIRD_AMOUNT / 2, () => best.net.nextGeneration()),\n                ...this.createBirds(BIRD_AMOUNT / 2, firstGen)\n            ];\n        } else {\n            this.birds = this.createBirds(BIRD_AMOUNT, firstGen);\n        }\n    }\n\n    private _loop(): void {\n        this.loop();\n        if(this.FPS <= 0 || (this.automaticSuperSpeed && (!this.pauseWhenHighscore || this.score < this.maxScore))) {\n            (window as any).setZeroTimeout(() => {\n                this._loop();\n            });\n        } else {\n            setTimeout(() => {\n                this._loop();\n            }, 1e3/ this.FPS );\n        }\n    }\n\n    private loop(): void {\n        const birds = this.birds.filter(({ dead }) => !dead);\n        this.pipes = this.pipes.filter(({ dead }) => !dead);\n\n        if(birds.length <= 0) {\n            this.generation++;\n            this.respawn();\n            return;\n        }\n\n        if(this.pipes.length <= 0) {\n            this.pipeSpeed += PIPE_ACCELERATION;\n            this.pipes = [...Array(1)]\n                .map(() => new Pipe(Dimensions[0], Math.random() * (Dimensions[1] - PIPE_GAP * 2 - PIPE_MARGIN * 2) + PIPE_GAP + PIPE_MARGIN, this.pipeSpeed));\n        }\n\n        birds.forEach(bird => bird.loop(this.pipes));\n        this.pipes.forEach(pipe => pipe.loop());\n\n        this.score++;\n        if(this.score > this.maxScore && this.pauseWhenHighscore)\n            this.FPS = DEFAULT_FPS;\n    }\n\n    private render(ctx: CanvasRenderingContext2D) {\n        const dead = ({ dead }) => !dead;\n\n        this.birds.filter(dead).forEach(bird => bird.draw(ctx));\n        this.pipes.filter(dead).forEach(pipe => pipe.draw(ctx));\n    }\n\n    private renderNet(ctx: CanvasRenderingContext2D) {\n        if(this.birds.length < 0) return;\n\n        const bird = this.birds.filter(({ dead }) => !dead)[0];\n        if(bird) bird.net.draw(ctx);\n    }\n}","import Flappy from \"./Flappy\";\nimport Resource from \"./Resource\";\nimport Ctx, { TextPosition } from \"./Ctx\";\n\nexport const Resources = {\n    pipeBottom: new Resource('./static/pipebottom.png'),\n    pipeTop: new Resource('./static/pipetop.png'),\n    bird: new Resource('./static/bird.png'),\n    background: new Resource('./static/background.png')\n};\n\nexport const Dimensions = [300, 500];\n\nexport const createGame = async () => {\n    const ctx = new Ctx({\n        showFps: true,\n        size: 18,\n        w: Dimensions[0],\n        h: Dimensions[1]\n    });\n\n    const nctx = new Ctx({\n        size: 18,\n        w: window.innerWidth - Dimensions[0],\n        h: Dimensions[1]\n    });\n\n    const files = Object.entries(Resources);\n    let loadedFiles = 0;\n\n    const loading = files.map(([,v]) => v.load());\n    loading.forEach(v => v.then(() => loadedFiles++));\n\n    const remove = [\n        ctx.queueText(() => `Loading...`, () => true, TextPosition.Middle),\n        ctx.queueText(() => `${loadedFiles}/${files.length}`, () => true, TextPosition.Middle)\n    ]\n\n    await Promise.all(loading);\n    remove.forEach(v => v());\n\n    return new Flappy({\n        ctx,\n        nctx\n    });\n}","import Ctx, { drawCircle, drawText } from \"./Ctx\";\n\ntype NetworkStructure = number[]; // input, hidden[], output\n\n// const sigmoid = z => 1 / (1 + Math.pow(Math.E, -z));\n\nconst random = () => Math.random() * 2 - 1;\nconst sigmoid = z => (1 / (1 + Math.exp((-z)/1)));\nconst sigmoidf = (a = 1, b = 0) => z => (1 / (1 + Math.exp(-a*(z-b))));\n\nconst MUTATION_CHANCE = .2;\nconst MUTATION_FORCE = .1;\n\nclass Neuron {\n    private weights: number[];\n    private lastValue: number;\n\n    constructor(inputs: number, weights?: number[]) {\n        this.weights = weights || [...Array(inputs)].map(() => random());\n    }\n\n    public forward(values: number[]): number {\n        return this.lastValue = sigmoid(\n            values.map((v, i) => (this.weights[i] || 1) * v)\n                .reduce((a, v) => a + v, 0)\n        );\n    }\n\n    public randomize(): Neuron {\n        return new Neuron(null, this.weights.map(v => Math.random() > MUTATION_CHANCE ? v : v + random() * MUTATION_FORCE));\n    }\n\n    public getLastValue(): number {\n        return this.lastValue;\n    }\n}\n\nexport default class NeuralNet {\n    private structure: NetworkStructure;\n    private neurons: Neuron[][];\n\n    constructor(structure: NetworkStructure, neurons?: Neuron[][]) {\n        this.structure = structure;\n        this.neurons = neurons || structure.map((v, i, a) =>\n            [...Array(v)].map(() => new Neuron(i == 0 ? 0 : a[i - 1]))\n        );\n    }\n\n    public forward(values: number[]): number[] {\n        if(values.length != this.neurons[0].length) {\n            console.error('Input length not equal to input neuron layer');\n            return;\n        }\n\n        const result = [...Array(this.neurons.length)];\n        this.neurons[0].forEach((v, i) => v.forward([values[i]]));\n        this.neurons.forEach((layer, i) => result[i] = i == 0 ? values : layer.map(neuron => neuron.forward(result[i - 1])));\n\n        // console.log(result);\n        return result[result.length - 1];\n    }\n\n    public nextGeneration(): NeuralNet {\n        return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => neuron.randomize())));\n    }\n\n    // public breed(a: NeuralNet, b: NeuralNet): NeuralNet {\n    //     return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => )))\n    // }\n\n    public draw(ctx: CanvasRenderingContext2D): void {\n        const radius = 50;\n        const padding = 10;\n\n        const tallest = Math.max(...this.structure) * (radius + padding);\n\n        this.neurons.forEach((layer, layeri, layerarr) => {\n\n            layer.forEach((neuron, neuroni) => {\n                const height = radius * 2 + padding + neuroni * (radius * 2 + padding);\n                const missing = (tallest - layer.length * (radius * 2)) / 2;\n                const lastValue = neuron.getLastValue();\n\n                // const sigmoid = z => (.5 / (1 + Math.exp((-z)/1)));\n\n                const color = (sigmoidf(10, .5)(lastValue)) * 255;\n                // console.log(sigmoidf(10, 0)(lastValue));\n\n                drawCircle(\n                    ctx,\n                    radius + layeri * (radius * 2 + padding),\n                    height + missing,\n                    radius,\n                    [color, 0, 0, color]\n                );\n\n                if(lastValue)\n                    drawText(\n                        ctx,\n                        `${neuron.getLastValue().toFixed(4)}`,\n                        radius + layeri * (radius * 2 + padding) - padding * 2,\n                        height + missing + padding / 2,\n                        [255, 255, 255, 255]\n                    );\n\n                if(layeri == 0) return;\n            });\n        });\n    }\n}","import { Dimensions } from \"./Game\";\n\nexport interface LoadStatus {\n    status: string,\n    value?: any\n};\n\nexport default class Resource {\n    private img: HTMLImageElement;\n    private loaded: boolean = false;\n    private didLoad: Promise<LoadStatus>;\n\n    constructor(file: string) {\n        this.init(file);\n    }\n\n    private async init(file: string) {\n        this.img = new Image();\n        this.img.src = file;\n        this.didLoad = new Promise((res, rej) => {\n            this.img.onload = value => res({\n                status: 'success',\n                value\n            });\n            this.img.onerror = err => res({\n                status: 'error',\n                value: err\n            });\n        })\n        await this.didLoad;\n        this.loaded = true;\n    }\n\n    public load(): Promise<LoadStatus> {\n        return this.didLoad;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D, x: number, y: number, w?: number, h?: number, angle?: number) {\n        if(!this.loaded) {\n            console.warn('Image tried to draw when not loaded', this.img.src);\n            return;\n        }\n\n        let _x = x;\n        let _y = y;\n\n        if(angle) {\n            ctx.save();\n            ctx.translate(x + this.img.width / 2, y + this.img.height / 2);\n            ctx.rotate(angle);\n\n            _x = -this.img.width / 2;\n            _y = -this.img.height / 2;\n        }\n\n        if(w && h) ctx.drawImage(this.img, _x, _y, w, h);\n        else ctx.drawImage(this.img, _x, _y);\n\n        if(angle)\n            ctx.restore();\n    }\n\n    public dimensions(): [number, number] {\n        if(!this.loaded) {\n            console.warn('Image tried to get dimensions when not loaded', this.img.src);\n            return;\n        }\n        return [this.img.width, this.img.height];\n    }\n}"],"sourceRoot":""}